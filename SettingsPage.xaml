<UserControl x:Class="MooseTracks.Views.SettingsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:MooseTracks"
             Background="{DynamicResource AppBackground}"
             Height="810" Width="922">

    <UserControl.Resources>
        <local:ColorConverter x:Key="ColorConverter"/>

        <!-- Theme-matching inputs -->
        <Style TargetType="TextBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="CaretBrush" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        </Style>

        <Style TargetType="ListBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        </Style>

        <Style x:Key="SectionGroupBox" TargetType="GroupBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>

            <!-- Reserve 1px permanently so layout doesn't shift when the overlay thickness changes -->
            <Setter Property="Padding" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,10"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid SnapsToDevicePixels="True">
                            <!-- No visible stroke here -->
                            <Border x:Name="Chrome"
                            CornerRadius="6"
                            Background="{TemplateBinding Background}"
                            BorderBrush="Transparent"
                            BorderThickness="0"
                            Padding="{TemplateBinding Padding}">
                                <Grid Margin="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0"
                                       Text="{TemplateBinding Header}"
                                       Foreground="{DynamicResource AppForeground}"
                                       FontWeight="Bold"
                                       Margin="0,0,0,6"/>

                                    <ContentPresenter Grid.Row="1" ContentSource="Content"/>
                                </Grid>
                            </Border>

                            <!-- Only this draws the border; 0 really means 0 -->
                            <Rectangle RadiusX="6" RadiusY="6"
                               IsHitTestVisible="False"
                               Stroke="{DynamicResource AppBorderBrush}"
                               StrokeThickness="{DynamicResource AppBorderStrokeThickness}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Numeric RGB box (white text on black) -->
        <Style x:Key="RgbValueBox" TargetType="TextBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Black"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="22"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="10,10,10,26">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- FFmpeg Path -->
        <GroupBox Header="FFmpeg Configuration"
                  Style="{StaticResource SectionGroupBox}"
                  Grid.Row="0">
            <StackPanel>
                <DockPanel Margin="0,0,0,5">
                    <TextBlock Text="FFmpeg Path:" Width="120" VerticalAlignment="Center"
                               Foreground="{DynamicResource AppForeground}"/>
                    <TextBox x:Name="FFmpegPathTextBox" Width="400" Height="22"/>
                    <Button x:Name="BrowseFFmpegButton" Content="Browse" Width="80" Margin="8,0,0,0"
                            Click="BrowseFFmpegButton_Click"/>
                </DockPanel>
                <Button x:Name="SaveFFmpegButton" Content="Save FFmpeg Path" Width="140"
                        HorizontalAlignment="Right" Margin="0,6,0,0"
                        Click="SaveFFmpegButton_Click"/>
            </StackPanel>
        </GroupBox>

        <!-- Theme Settings -->
        <GroupBox Header="Theme Configuration"
                  Style="{StaticResource SectionGroupBox}"
                  Grid.Row="1" Margin="0,10,0,26">
            <StackPanel Height="616">

                <!-- Theme pick (black text) -->
                <DockPanel Margin="0,0,0,10">
                    <TextBlock Text="Theme:" Width="120" VerticalAlignment="Center"
                               Foreground="{DynamicResource AppForeground}"/>
                    <ComboBox x:Name="ThemeComboBox" Width="220"
                              Foreground="Black"
                              Background="{DynamicResource BoxesBackgroundBrush}"
                              SelectionChanged="ThemeComboBox_SelectionChanged"/>
                    <Button x:Name="SaveDefaultThemeButton" Content="Set as Default"
                            Width="120" Margin="8,0,0,0"
                            Click="SaveDefaultThemeButton_Click"/>
                </DockPanel>

                <!-- Background -->
                <DockPanel Margin="0,0,0,10">
                    <TextBlock Text="Background:" Width="120" VerticalAlignment="Top"
                               Foreground="{DynamicResource AppForeground}"/>
                    <StackPanel Width="300">
                        <DockPanel Margin="0,0,0,2">
                            <TextBlock Text="R:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BackgroundRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BackgroundRSlider" Minimum="0" Maximum="255" Value="0"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel Margin="0,0,0,2">
                            <TextBlock Text="G:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BackgroundGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BackgroundGSlider" Minimum="0" Maximum="255" Value="0"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel>
                            <TextBlock Text="B:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BackgroundBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BackgroundBSlider" Minimum="0" Maximum="255" Value="0"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <Rectangle x:Name="BackgroundPreview" Height="20" Margin="0,6,0,0"
                                   Stroke="{DynamicResource AppBorderBrush}" StrokeThickness="1">
                            <Rectangle.Fill>
                                <MultiBinding Converter="{StaticResource ColorConverter}">
                                    <Binding ElementName="BackgroundRSlider" Path="Value"/>
                                    <Binding ElementName="BackgroundGSlider" Path="Value"/>
                                    <Binding ElementName="BackgroundBSlider" Path="Value"/>
                                </MultiBinding>
                            </Rectangle.Fill>
                        </Rectangle>
                    </StackPanel>
                </DockPanel>

                <!-- Text Colour -->
                <DockPanel Margin="0,0,0,10">
                    <TextBlock Text="Text Colour:" Width="120" VerticalAlignment="Top"
                               Foreground="{DynamicResource AppForeground}"/>
                    <StackPanel Width="300">
                        <DockPanel Margin="0,0,0,2">
                            <TextBlock Text="R:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=ForegroundRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="ForegroundRSlider" Minimum="0" Maximum="255" Value="255"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel Margin="0,0,0,2">
                            <TextBlock Text="G:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=ForegroundGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="ForegroundGSlider" Minimum="0" Maximum="255" Value="255"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel>
                            <TextBlock Text="B:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=ForegroundBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="ForegroundBSlider" Minimum="0" Maximum="255" Value="255"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <Rectangle x:Name="ForegroundPreview" Height="20" Margin="0,6,0,0"
                                   Stroke="{DynamicResource AppBorderBrush}" StrokeThickness="1">
                            <Rectangle.Fill>
                                <MultiBinding Converter="{StaticResource ColorConverter}">
                                    <Binding ElementName="ForegroundRSlider" Path="Value"/>
                                    <Binding ElementName="ForegroundGSlider" Path="Value"/>
                                    <Binding ElementName="ForegroundBSlider" Path="Value"/>
                                </MultiBinding>
                            </Rectangle.Fill>
                        </Rectangle>
                    </StackPanel>
                </DockPanel>

                <!-- Border -->
                <DockPanel Margin="0,0,0,10">
                    <TextBlock Text="Border:" Width="120" VerticalAlignment="Top"
                               Foreground="{DynamicResource AppForeground}"/>
                    <StackPanel Width="300">
                        <DockPanel Margin="0,0,0,2">
                            <TextBlock Text="R:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BorderRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BorderRSlider" Minimum="0" Maximum="255" Value="255"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel Margin="0,0,0,2">
                            <TextBlock Text="G:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BorderGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BorderGSlider" Minimum="0" Maximum="255" Value="165"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel>
                            <TextBlock Text="B:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BorderBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BorderBSlider" Minimum="0" Maximum="255" Value="0"
                                    ValueChanged="ColorSlider_ValueChanged"/>
                        </DockPanel>
                        <Rectangle x:Name="BorderPreview" Height="20" Margin="0,6,0,0"
                                   Stroke="{DynamicResource AppBorderBrush}" StrokeThickness="1">
                            <Rectangle.Fill>
                                <MultiBinding Converter="{StaticResource ColorConverter}">
                                    <Binding ElementName="BorderRSlider" Path="Value"/>
                                    <Binding ElementName="BorderGSlider" Path="Value"/>
                                    <Binding ElementName="BorderBSlider" Path="Value"/>
                                </MultiBinding>
                            </Rectangle.Fill>
                        </Rectangle>
                    </StackPanel>
                </DockPanel>

                <!-- Boxes Colour -->
                <DockPanel Margin="0,0,0,10">
                    <TextBlock Text="Boxes Colour:" Width="120" VerticalAlignment="Top"
                               Foreground="{DynamicResource AppForeground}"/>
                    <StackPanel Width="340">
                        <DockPanel Margin="0,0,0,2">
                            <TextBlock Text="R:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BoxesRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BoxesRSlider" Minimum="0" Maximum="255" Value="59"
                                    ValueChanged="BoxesColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel Margin="0,0,0,2">
                            <TextBlock Text="G:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BoxesGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BoxesGSlider" Minimum="0" Maximum="255" Value="130"
                                    ValueChanged="BoxesColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel>
                            <TextBlock Text="B:" Width="22"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BoxesBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BoxesBSlider" Minimum="0" Maximum="255" Value="246"
                                    ValueChanged="BoxesColorSlider_ValueChanged"/>
                        </DockPanel>
                        <DockPanel Margin="0,6,0,0">
                            <TextBlock Text="Fill %" Width="50"/>
                            <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                     Style="{StaticResource RgbValueBox}"
                                     Text="{Binding ElementName=BoxesFillSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                            <Slider x:Name="BoxesFillSlider" Minimum="0" Maximum="100" Value="10"
                                    ValueChanged="BoxesColorSlider_ValueChanged"/>
                        </DockPanel>
                        <Rectangle x:Name="BoxesPreview" Height="20" Margin="0,6,0,0"
                                   StrokeThickness="1" Stroke="{DynamicResource AppBorderBrush}">
                            <Rectangle.Fill>
                                <MultiBinding Converter="{StaticResource ColorConverter}">
                                    <Binding ElementName="BoxesRSlider" Path="Value"/>
                                    <Binding ElementName="BoxesGSlider" Path="Value"/>
                                    <Binding ElementName="BoxesBSlider" Path="Value"/>
                                </MultiBinding>
                            </Rectangle.Fill>
                        </Rectangle>
                    </StackPanel>
                </DockPanel>

                <!-- Border Thickness (0–4), uses overlay stroke thickness -->
                <DockPanel Margin="0,6,0,14">
                    <TextBlock Text="Border Thickness:" Width="120" VerticalAlignment="Center"
                               Foreground="{DynamicResource AppForeground}"/>
                    <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                             Style="{StaticResource RgbValueBox}"
                             Text="{Binding ElementName=BorderThicknessSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                    <Slider x:Name="BorderThicknessSlider"
                            Minimum="0" Maximum="4" Value="1"
                            ValueChanged="BorderThicknessSlider_ValueChanged"
                            Width="300"/>
                </DockPanel>

                <!-- Theme Save -->
                <DockPanel Margin="0,0,0,10">
                    <TextBlock Text="Theme Name:" Width="120" VerticalAlignment="Center"
                               Foreground="{DynamicResource AppForeground}"/>
                    <TextBox x:Name="ThemeNameTextBox" Width="220" Height="22"/>
                    <Button x:Name="SaveThemeButton" Content="Save Theme" Width="110" Margin="8,0,0,0"
                            Click="SaveThemeButton_Click"/>
                </DockPanel>

                <Button x:Name="ApplyThemeButton" Content="Apply Theme" Width="110"
                        HorizontalAlignment="Right" Margin="0,6,0,0"
                        Click="ApplyThemeButton_Click"/>

            </StackPanel>
        </GroupBox>
    </Grid>
</UserControl>
