<UserControl x:Class="MooseTracks.Views.Theme"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:MooseTracks"
             Background="{DynamicResource AppBackground}"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">

    <UserControl.Resources>
        <!-- Your existing converter -->
        <local:ColorConverter x:Key="ColorConverter"/>

        <!-- Same chrome as before -->
        <Style x:Key="SectionGroupBox" TargetType="GroupBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
            <Setter Property="Padding" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid SnapsToDevicePixels="True">
                            <Border CornerRadius="6"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="Transparent"
                                    BorderThickness="0"
                                    Padding="{TemplateBinding Padding}">
                                <Grid Margin="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Grid.Row="0"
                                               Text="{TemplateBinding Header}"
                                               Foreground="{DynamicResource AppForeground}"
                                               FontWeight="Bold"
                                               Margin="0,0,0,6"/>
                                    <ContentPresenter Grid.Row="1" ContentSource="Content"/>
                                </Grid>
                            </Border>
                            <Rectangle RadiusX="6" RadiusY="6"
                                       IsHitTestVisible="False"
                                       Stroke="{DynamicResource AppBorderBrush}"
                                       StrokeThickness="{DynamicResource AppBorderStrokeThickness}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Small numeric textbox in RGB rows -->
        <Style x:Key="RgbValueBox" TargetType="TextBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Black"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="22"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <GroupBox Header="Theme Configuration"
                  Style="{StaticResource SectionGroupBox}"
                  Margin="0,10,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto" CanContentScroll="True">
                <StackPanel>

                    <!-- Theme picker -->
                    <DockPanel Margin="0,0,0,10">
                        <TextBlock Text="Theme:" Width="120" VerticalAlignment="Center"
                                   Foreground="{DynamicResource AppForeground}"/>
                        <ComboBox x:Name="ThemeComboBox" Width="220"
                                  Foreground="Black"
                                  Background="{DynamicResource BoxesBackgroundBrush}"
                                  SelectionChanged="ThemeComboBox_SelectionChanged"
                                  ToolTip="{StaticResource TT.Theme.ThemeComboBox}"/>
                        <Button x:Name="SaveDefaultThemeButton" Content="Set as Default"
                                Width="120" Margin="8,0,0,0"
                                Click="SaveDefaultThemeButton_Click"
                                ToolTip="{StaticResource TT.Theme.SaveDefaultThemeButton}"/>
                    </DockPanel>

                    <!-- Background -->
                    <DockPanel Margin="0,0,0,10">
                        <TextBlock Text="Background:" Width="120" VerticalAlignment="Top"
                                   Foreground="{DynamicResource AppForeground}"/>
                        <StackPanel Width="300">
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="R:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BackgroundR}"
                                         Text="{Binding ElementName=BackgroundRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BackgroundRSlider" Minimum="0" Maximum="255" Value="0"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BackgroundR}"/>
                            </DockPanel>
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="G:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BackgroundG}"
                                         Text="{Binding ElementName=BackgroundGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BackgroundGSlider" Minimum="0" Maximum="255" Value="0"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BackgroundG}"/>
                            </DockPanel>
                            <DockPanel>
                                <TextBlock Text="B:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BackgroundB}"
                                         Text="{Binding ElementName=BackgroundBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BackgroundBSlider" Minimum="0" Maximum="255" Value="0"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BackgroundB}"/>
                            </DockPanel>
                            <Rectangle x:Name="BackgroundPreview" Height="20" Margin="0,6,0,0"
                                       Stroke="{DynamicResource AppBorderBrush}" StrokeThickness="1"
                                       ToolTip="{StaticResource TT.Theme.BackgroundPreview}">
                                <Rectangle.Fill>
                                    <MultiBinding Converter="{StaticResource ColorConverter}">
                                        <Binding ElementName="BackgroundRSlider" Path="Value"/>
                                        <Binding ElementName="BackgroundGSlider" Path="Value"/>
                                        <Binding ElementName="BackgroundBSlider" Path="Value"/>
                                    </MultiBinding>
                                </Rectangle.Fill>
                            </Rectangle>
                        </StackPanel>
                    </DockPanel>

                    <!-- Text colour -->
                    <DockPanel Margin="0,0,0,10">
                        <TextBlock Text="Text Colour:" Width="120" VerticalAlignment="Top"
                                   Foreground="{DynamicResource AppForeground}"/>
                        <StackPanel Width="300">
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="R:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.ForegroundR}"
                                         Text="{Binding ElementName=ForegroundRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="ForegroundRSlider" Minimum="0" Maximum="255" Value="255"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.ForegroundR}"/>
                            </DockPanel>
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="G:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.ForegroundG}"
                                         Text="{Binding ElementName=ForegroundGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="ForegroundGSlider" Minimum="0" Maximum="255" Value="255"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.ForegroundG}"/>
                            </DockPanel>
                            <DockPanel>
                                <TextBlock Text="B:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.ForegroundB}"
                                         Text="{Binding ElementName=ForegroundBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="ForegroundBSlider" Minimum="0" Maximum="255" Value="255"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.ForegroundB}"/>
                            </DockPanel>
                            <Rectangle x:Name="ForegroundPreview" Height="20" Margin="0,6,0,0"
                                       Stroke="{DynamicResource AppBorderBrush}" StrokeThickness="1"
                                       ToolTip="{StaticResource TT.Theme.ForegroundPreview}">
                                <Rectangle.Fill>
                                    <MultiBinding Converter="{StaticResource ColorConverter}">
                                        <Binding ElementName="ForegroundRSlider" Path="Value"/>
                                        <Binding ElementName="ForegroundGSlider" Path="Value"/>
                                        <Binding ElementName="ForegroundBSlider" Path="Value"/>
                                    </MultiBinding>
                                </Rectangle.Fill>
                            </Rectangle>
                        </StackPanel>
                    </DockPanel>

                    <!-- Border colour -->
                    <DockPanel Margin="0,0,0,10">
                        <TextBlock Text="Border:" Width="120" VerticalAlignment="Top"
                                   Foreground="{DynamicResource AppForeground}"/>
                        <StackPanel Width="300">
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="R:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BorderR}"
                                         Text="{Binding ElementName=BorderRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BorderRSlider" Minimum="0" Maximum="255" Value="255"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BorderR}"/>
                            </DockPanel>
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="G:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BorderG}"
                                         Text="{Binding ElementName=BorderGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BorderGSlider" Minimum="0" Maximum="255" Value="165"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BorderG}"/>
                            </DockPanel>
                            <DockPanel>
                                <TextBlock Text="B:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BorderB}"
                                         Text="{Binding ElementName=BorderBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BorderBSlider" Minimum="0" Maximum="255" Value="0"
                                        ValueChanged="ColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BorderB}"/>
                            </DockPanel>
                            <Rectangle x:Name="BorderPreview" Height="20" Margin="0,6,0,0"
                                       Stroke="{DynamicResource AppBorderBrush}" StrokeThickness="1"
                                       ToolTip="{StaticResource TT.Theme.BorderPreview}">
                                <Rectangle.Fill>
                                    <MultiBinding Converter="{StaticResource ColorConverter}">
                                        <Binding ElementName="BorderRSlider" Path="Value"/>
                                        <Binding ElementName="BorderGSlider" Path="Value"/>
                                        <Binding ElementName="BorderBSlider" Path="Value"/>
                                    </MultiBinding>
                                </Rectangle.Fill>
                            </Rectangle>
                        </StackPanel>
                    </DockPanel>

                    <!-- Boxes colour + fill -->
                    <DockPanel Margin="0,0,0,10">
                        <TextBlock Text="Boxes Colour:" Width="120" VerticalAlignment="Top"
                                   Foreground="{DynamicResource AppForeground}"/>
                        <StackPanel Width="300">
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="R:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BoxesR}"
                                         Text="{Binding ElementName=BoxesRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BoxesRSlider" Minimum="0" Maximum="255" Value="59"
                                        ValueChanged="BoxesColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BoxesR}"/>
                            </DockPanel>
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="G:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BoxesG}"
                                         Text="{Binding ElementName=BoxesGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BoxesGSlider" Minimum="0" Maximum="255" Value="130"
                                        ValueChanged="BoxesColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BoxesG}"/>
                            </DockPanel>
                            <DockPanel>
                                <TextBlock Text="B:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BoxesB}"
                                         Text="{Binding ElementName=BoxesBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BoxesBSlider" Minimum="0" Maximum="255" Value="246"
                                        ValueChanged="BoxesColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BoxesB}"/>
                            </DockPanel>

                            <DockPanel Margin="0,6,0,0">
                                <TextBlock Text="Fill %" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BoxesFill}"
                                         Text="{Binding ElementName=BoxesFillSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BoxesFillSlider" Minimum="0" Maximum="100" Value="10"
                                        ValueChanged="BoxesColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BoxesFill}"/>
                            </DockPanel>

                            <Rectangle x:Name="BoxesPreview" Height="20" Margin="0,6,0,0"
                                       StrokeThickness="1" Stroke="{DynamicResource AppBorderBrush}"
                                       ToolTip="{StaticResource TT.Theme.BoxesPreview}">
                                <Rectangle.Fill>
                                    <MultiBinding Converter="{StaticResource ColorConverter}">
                                        <Binding ElementName="BoxesRSlider" Path="Value"/>
                                        <Binding ElementName="BoxesGSlider" Path="Value"/>
                                        <Binding ElementName="BoxesBSlider" Path="Value"/>
                                    </MultiBinding>
                                </Rectangle.Fill>
                            </Rectangle>
                        </StackPanel>
                    </DockPanel>

                    <!-- Progress Bar colour -->
                    <DockPanel Margin="0,0,0,10">
                        <TextBlock Text="Progress Bar:" Width="120" VerticalAlignment="Top"
                                   Foreground="{DynamicResource AppForeground}"/>
                        <StackPanel Width="300">
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="R:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.ProgressR}"
                                         Text="{Binding ElementName=ProgressRSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="ProgressRSlider" Minimum="0" Maximum="255" Value="59"
                                        ValueChanged="ProgressColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.ProgressR}"/>
                            </DockPanel>
                            <DockPanel Margin="0,0,0,2">
                                <TextBlock Text="G:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.ProgressG}"
                                         Text="{Binding ElementName=ProgressGSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="ProgressGSlider" Minimum="0" Maximum="255" Value="130"
                                        ValueChanged="ProgressColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.ProgressG}"/>
                            </DockPanel>
                            <DockPanel>
                                <TextBlock Text="B:" Width="32"/>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.ProgressB}"
                                         Text="{Binding ElementName=ProgressBSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="ProgressBSlider" Minimum="0" Maximum="255" Value="246"
                                        ValueChanged="ProgressColorSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.ProgressB}"/>
                            </DockPanel>

                            <Rectangle x:Name="ProgressPreview" Height="20" Margin="0,6,0,0"
                                       StrokeThickness="1" Stroke="{DynamicResource AppBorderBrush}"
                                       ToolTip="{StaticResource TT.Theme.ProgressPreview}">
                                <Rectangle.Fill>
                                    <MultiBinding Converter="{StaticResource ColorConverter}">
                                        <Binding ElementName="ProgressRSlider" Path="Value"/>
                                        <Binding ElementName="ProgressGSlider" Path="Value"/>
                                        <Binding ElementName="ProgressBSlider" Path="Value"/>
                                    </MultiBinding>
                                </Rectangle.Fill>
                            </Rectangle>
                        </StackPanel>
                    </DockPanel>

                    <!-- Border thickness -->
                    <DockPanel Margin="0,6,0,14">
                        <TextBlock Text="Border Thickness:" Width="120" VerticalAlignment="Top"
                                   Foreground="{DynamicResource AppForeground}"/>
                        <StackPanel Width="300">
                            <DockPanel>
                                <TextBox DockPanel.Dock="Right" Margin="6,0,0,0"
                                         Style="{StaticResource RgbValueBox}"
                                         ToolTip="{StaticResource TT.Theme.BorderThicknessSlider}"
                                         Text="{Binding ElementName=BorderThicknessSlider, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=F0}"/>
                                <Slider x:Name="BorderThicknessSlider"
                                        Minimum="0" Maximum="4" Value="1"
                                        ValueChanged="BorderThicknessSlider_ValueChanged"
                                        ToolTip="{StaticResource TT.Theme.BorderThicknessSlider}"/>
                            </DockPanel>
                        </StackPanel>
                    </DockPanel>

                    <!-- Save/apply -->
                    <DockPanel Margin="0,0,0,10">
                        <TextBlock Text="Theme Name:" Width="120" VerticalAlignment="Center"
                                   Foreground="{DynamicResource AppForeground}"/>
                        <TextBox x:Name="ThemeNameTextBox" Width="220" Height="22"
                                 ToolTip="{StaticResource TT.Theme.ThemeNameTextBox}"/>
                        <Button x:Name="SaveThemeButton" Content="Save Theme" Width="110" Margin="8,0,0,0"
                                Click="SaveThemeButton_Click"
                                ToolTip="{StaticResource TT.Theme.SaveThemeButton}"/>
                        <Button x:Name="ApplyThemeButton" Content="Apply Theme" Width="110" Margin="8,0,0,0"
                                Click="ApplyThemeButton_Click"
                                ToolTip="{StaticResource TT.Theme.ApplyThemeButton}"/>
                    </DockPanel>

                </StackPanel>
            </ScrollViewer>
        </GroupBox>
    </Grid>
</UserControl>
