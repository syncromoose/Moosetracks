<UserControl x:Class="MooseTracks.Views.TranscodingPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{DynamicResource AppBackground}"
             Height="750" Width="922">

    <UserControl.Resources>
        <!-- GroupBox: header inside the box, one clean outer border -->
        <Style x:Key="SectionGroupBox" TargetType="GroupBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Border CornerRadius="6"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{DynamicResource AppBorderThickness}"
                                Background="{TemplateBinding Background}"
                                SnapsToDevicePixels="True">
                            <!-- Scoped styles to keep inner controls tidy -->
                            <Border.Resources>
                                <!-- Default themed combo look (can be overridden per-control) -->
                                <Style TargetType="ComboBox">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
                                </Style>
                                <Style TargetType="ProgressBar">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource BoxesBorderBrush}"/>
                                </Style>
                            </Border.Resources>

                            <!-- Header INSIDE box + content below -->
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <ContentPresenter Grid.Row="0"
                                                  ContentSource="Header"
                                                  RecognizesAccessKey="True"
                                                  Margin="0,0,0,6"
                                                  TextElement.Foreground="{DynamicResource AppForeground}"
                                                  TextElement.FontWeight="Bold"/>

                                <ContentPresenter Grid.Row="1" ContentSource="Content"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Reusable themed inputs -->
        <Style x:Key="ThemedTextBox" TargetType="TextBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        </Style>

        <Style x:Key="ThemedListBox" TargetType="ListBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <!-- Slightly slimmer bottom row -->
            <RowDefinition Height="Auto" MinHeight="220"/>
        </Grid.RowDefinitions>

        <!-- Left Panel -->
        <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Vertical" Margin="0,0,15,0">

            <!-- Input File -->
            <GroupBox Header="Input File" Style="{StaticResource SectionGroupBox}">
                <DockPanel>
                    <TextBox x:Name="InputFilePathBox"
                             Width="400"
                             IsReadOnly="True"
                             Style="{StaticResource ThemedTextBox}"/>
                    <Button x:Name="BrowseInputButton" Content="Browse" Width="80" Margin="8,0,0,0"
                            BorderBrush="{DynamicResource AppBorderBrush}"
                            Click="BrowseInputButton_Click"/>
                </DockPanel>
            </GroupBox>

            <!-- File List -->
            <GroupBox Header="File List" Style="{StaticResource SectionGroupBox}">
                <ListBox x:Name="ExtractionOutputBox"
                         Height="120"
                         SelectionMode="Multiple"
                         SelectionChanged="ExtractionOutputBox_SelectionChanged"
                         Style="{StaticResource ThemedListBox}"/>
            </GroupBox>

            <!-- Output Path -->
            <GroupBox Header="Output Path" Style="{StaticResource SectionGroupBox}">
                <DockPanel>
                    <TextBox x:Name="OutputPathBox"
                             Width="400"
                             IsReadOnly="True"
                             Style="{StaticResource ThemedTextBox}"/>
                    <Button x:Name="BrowseOutputButton" Content="Browse" Width="80" Margin="8,0,0,0"
                            BorderBrush="{DynamicResource AppBorderBrush}"
                            Click="BrowseOutputButton_Click"/>
                </DockPanel>
            </GroupBox>

            <!-- Frame Rate Conversion -->
            <GroupBox Header="Frame Rate Conversion" Style="{StaticResource SectionGroupBox}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="2*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Left Column: Checkboxes -->
                    <StackPanel Grid.Column="0" Grid.Row="0" Grid.RowSpan="2" Orientation="Vertical">
                        <CheckBox x:Name="EnableFrameRateChangeCheckBox" Content="Enable Frame Rate Change"
                                  Foreground="{DynamicResource AppForeground}"
                                  Checked="EnableFrameRateChangeCheckBox_Checked"
                                  Unchecked="EnableFrameRateChangeCheckBox_Unchecked" Margin="0,0,0,5"/>
                        <CheckBox x:Name="PreservePitchCheckbox" Content="Preserve Pitch"
                                  Foreground="{DynamicResource AppForeground}" IsEnabled="False"/>
                    </StackPanel>

                    <!-- Right Column: FPS selectors -->
                    <Grid Grid.Column="1" Grid.Row="0" Grid.RowSpan="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="80"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Source FPS:" VerticalAlignment="Center"
                                   Foreground="{DynamicResource AppForeground}" Margin="0,0,5,0"/>
                        <ComboBox Grid.Row="0" Grid.Column="1"
                                  x:Name="SourceFrameRateComboBox"
                                  Width="80"
                                  IsEnabled="False"
                                  Foreground="Black">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="VerticalContentAlignment"   Value="Center"/>
                                </Style>
                            </ComboBox.ItemContainerStyle>

                            <ComboBoxItem Content="23.976"/>
                            <ComboBoxItem Content="24"/>
                            <ComboBoxItem Content="25"/>
                            <ComboBoxItem Content="29.97"/>
                            <ComboBoxItem Content="30"/>
                        </ComboBox>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Target FPS:" VerticalAlignment="Center"
                                   Foreground="{DynamicResource AppForeground}" Margin="0,0,5,0"/>
                        <ComboBox Grid.Row="1" Grid.Column="1"
                                  x:Name="TargetFrameRateComboBox"
                                  Width="80"
                                  IsEnabled="False"
                                  Foreground="Black">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="VerticalContentAlignment"   Value="Center"/>
                                </Style>
                            </ComboBox.ItemContainerStyle>

                            <ComboBoxItem Content="23.976"/>
                            <ComboBoxItem Content="24"/>
                            <ComboBoxItem Content="25"/>
                            <ComboBoxItem Content="29.97"/>
                            <ComboBoxItem Content="30"/>
                        </ComboBox>
                    </Grid>
                </Grid>
            </GroupBox>
        </StackPanel>

        <!-- Right Panel -->
        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Vertical">
            <!-- File Info -->
            <GroupBox Header="File Info" Style="{StaticResource SectionGroupBox}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Filename:" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock x:Name="FileNameText" Grid.Row="0" Grid.Column="1" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Codec:" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock x:Name="CodecText" Grid.Row="1" Grid.Column="1" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Channels:" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock x:Name="ChannelsText" Grid.Row="2" Grid.Column="1" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Sample Rate:" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock x:Name="SampleRateText" Grid.Row="3" Grid.Column="1" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Bitrate:" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock x:Name="BitrateText" Grid.Row="4" Grid.Column="1" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Duration:" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock x:Name="DurationText" Grid.Row="5" Grid.Column="1" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock Grid.Row="6" Grid.Column="0" Text="Size:" Foreground="{DynamicResource AppForeground}"/>
                    <TextBlock x:Name="SizeText" Grid.Row="6" Grid.Column="1" Foreground="{DynamicResource AppForeground}"/>
                </Grid>
            </GroupBox>

            <!-- Format + Bitrate (bitrate moved under format) -->
            <GroupBox Header="Format and Gain" Style="{StaticResource SectionGroupBox}">
                <StackPanel>
                    <!-- Format row -->
                    <DockPanel Margin="0,0,0,5">
                        <TextBlock Text="Format:" Width="70" VerticalAlignment="Center" Foreground="{DynamicResource AppForeground}"/>
                        <ComboBox x:Name="FormatComboBox" Width="120" Height="22"
                                  Foreground="Black">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="VerticalContentAlignment"   Value="Center"/>
                                </Style>
                            </ComboBox.ItemContainerStyle>

                            <ComboBoxItem Content="wav"/>
                            <ComboBoxItem Content="wav64"/>
                            <ComboBoxItem Content="aac"/>
                            <ComboBoxItem Content="dts"/>
                            <ComboBoxItem Content="ac3"/>
                            <ComboBoxItem Content="eac3"/>
                            <ComboBoxItem Content="mp3"/>
                            <ComboBoxItem Content="flac"/>
                            <ComboBoxItem Content="ogg"/>
                            <ComboBoxItem Content="opus"/>
                        </ComboBox>
                    </DockPanel>

                    <!-- Bitrate row (now under format) -->
                    <DockPanel Margin="0,0,0,5">
                        <TextBlock Text="Bitrate:" Width="70" VerticalAlignment="Center" Foreground="{DynamicResource AppForeground}"/>
                        <ComboBox x:Name="BitrateComboBox" Width="120" Height="22"
                                  Foreground="Black">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="VerticalContentAlignment"   Value="Center"/>
                                </Style>
                            </ComboBox.ItemContainerStyle>
                        </ComboBox>
                    </DockPanel>

                    <!-- Gain row -->
                    <DockPanel Margin="0,0,0,5">
                        <TextBlock Text="Gain (dB):" Width="70" VerticalAlignment="Center" Foreground="{DynamicResource AppForeground}"/>
                        <TextBox x:Name="GainBox" Width="50" Text="0" Style="{StaticResource ThemedTextBox}"/>
                    </DockPanel>

                    <CheckBox x:Name="DownmixCheckBox" Content="Downmix to Stereo" Foreground="{DynamicResource AppForeground}"/>
                </StackPanel>
            </GroupBox>

            <Button x:Name="TranscodeTracksButton" Content="Start Transcoding" Width="200" Height="30" Margin="0,10,0,0"
                    Click="TranscodeTracksButton_Click"/>
        </StackPanel>

        <!-- Bottom FFmpeg Output (slimmer) -->
        <GroupBox Header="FFmpeg Output" Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2"
                  Style="{StaticResource SectionGroupBox}"
                  Margin="0,8,0,0">
            <StackPanel>
                <TextBlock Text="Progress:" Foreground="{DynamicResource AppForeground}" Margin="0,0,0,4"/>
                <ProgressBar x:Name="FFmpegProgressBar" Height="16" Minimum="0" Maximum="100" Value="0"/>

                <TextBlock Text="Output Log:" Foreground="{DynamicResource AppForeground}" Margin="0,6,0,4"/>
                <TextBox x:Name="FFmpegOutputBox" Height="130"
                         IsReadOnly="True"
                         VerticalScrollBarVisibility="Auto"
                         TextWrapping="Wrap"
                         Style="{StaticResource ThemedTextBox}"/>
            </StackPanel>
        </GroupBox>
    </Grid>
</UserControl>
