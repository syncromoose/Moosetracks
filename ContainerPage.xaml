<UserControl x:Class="MooseTracks.Views.ContainerPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{DynamicResource AppBackground}"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">

    <!-- Local styles (match your theme resources) -->
    <UserControl.Resources>
        <!-- Section group box with overlay border stroke -->
        <Style x:Key="SectionGroupBox" TargetType="GroupBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
            <Setter Property="Padding" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid SnapsToDevicePixels="True">
                            <Border CornerRadius="6"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="Transparent"
                                    BorderThickness="0"
                                    Padding="{TemplateBinding Padding}">
                                <Grid Margin="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0"
                                               Text="{TemplateBinding Header}"
                                               Foreground="{DynamicResource AppForeground}"
                                               FontWeight="Bold"
                                               Margin="0,0,0,6"/>

                                    <ContentPresenter Grid.Row="1" ContentSource="Content"/>
                                </Grid>
                            </Border>

                            <!-- Visual stroke overlay (no layout shift) -->
                            <Rectangle RadiusX="6" RadiusY="6"
                                       IsHitTestVisible="False"
                                       Stroke="{DynamicResource AppBorderBrush}"
                                       StrokeThickness="{DynamicResource AppBorderStrokeThickness}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ThemedTextBox" TargetType="TextBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        </Style>

        <Style x:Key="ThemedListBox" TargetType="ListBox">
            <Setter Property="Foreground" Value="{DynamicResource AppForeground}"/>
            <Setter Property="Background" Value="{DynamicResource BoxesBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        </Style>
    </UserControl.Resources>

    <!-- Layout: FFmpeg output docked at bottom; top content fills remaining space (no scrolling) -->
    <DockPanel Margin="10,10,10,10">

        <!-- BOTTOM: FFmpeg Output (fixed, tidy height so it won't cover content) -->
        <GroupBox DockPanel.Dock="Bottom"
                  Header="FFmpeg Output"
                  Style="{StaticResource SectionGroupBox}"
                  Margin="0,8,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                           Text="Progress:"
                           Foreground="{DynamicResource AppForeground}"
                           Margin="0,0,0,5"/>
                <ProgressBar Grid.Row="1"
                             x:Name="FFmpegProgressBar"
                             Height="16"
                             Minimum="0"
                             Maximum="100"
                             Value="0"
                             ToolTip="{StaticResource TT.Container.FFmpegProgressBar}"/>

                <TextBlock Grid.Row="2"
                           Text="Output Log:"
                           Foreground="{DynamicResource AppForeground}"
                           Margin="0,10,0,5"/>
                <!-- Fixed height so this block never eats the page -->
                <TextBox Grid.Row="3"
                         x:Name="FFmpegOutputBox"
                         Height="120"
                         IsReadOnly="True"
                         FontFamily="Consolas, 'Courier New', monospace"
                         FontSize="12"
                         AcceptsReturn="True"
                         TextWrapping="NoWrap"
                         HorizontalScrollBarVisibility="Auto"
                         VerticalScrollBarVisibility="Auto"
                         Style="{StaticResource ThemedTextBox}"
                         ToolTip="{StaticResource TT.Container.FFmpegOutputBox}"/>
            </Grid>
        </GroupBox>

        <!-- TOP: two-column content fills the rest -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT column: Input, Tracks (fixed height), Output -->
            <Grid Grid.Column="0" Margin="0,0,15,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Input -->
                    <RowDefinition Height="Auto"/>
                    <!-- Tracks header & list (fixed height) -->
                    <RowDefinition Height="Auto"/>
                    <!-- Output -->
                </Grid.RowDefinitions>

                <!-- Input file -->
                <GroupBox Grid.Row="0"
                          Header="Input File"
                          Style="{StaticResource SectionGroupBox}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="InputFilePathBox"
                                 Grid.Column="0"
                                 IsReadOnly="True"
                                 MinWidth="300"
                                 Margin="0,0,8,0"
                                 VerticalAlignment="Center"
                                 Style="{StaticResource ThemedTextBox}"
                                 ToolTip="{StaticResource TT.Container.InputFilePathBox}"/>
                        <Button x:Name="BrowseInputButton"
                                Grid.Column="1"
                                Content="Browse…"
                                Width="90" Height="24"
                                VerticalAlignment="Center"
                                BorderBrush="{DynamicResource AppBorderBrush}"
                                Click="BrowseInputButton_Click"
                                ToolTip="{StaticResource TT.Container.BrowseInputButton}"/>
                    </Grid>
                </GroupBox>

                <!-- Tracks (fixed-height list so the right column stays visible) -->
                <GroupBox Grid.Row="1"
                          Header="Tracks in Container"
                          Style="{StaticResource SectionGroupBox}">
                    <Grid>
                        <ListBox x:Name="ExtractionOutputBox"
                                 Height="260"
                                 SelectionMode="Extended"
                                 AllowDrop="True"
                                 PreviewDragOver="TracksList_PreviewDragOver"
                                 Drop="TracksList_Drop"
                                 SelectionChanged="ExtractionOutputBox_SelectionChanged"
                                 Style="{StaticResource ThemedListBox}"
                                 ToolTip="{StaticResource TT.Container.ExtractionOutputBox}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <DockPanel LastChildFill="True">
                                        <CheckBox Margin="0,0,8,0"
                                                  Focusable="False"
                                                  IsChecked="{Binding IsIncluded, Mode=TwoWay}"/>
                                        <TextBlock Text="{Binding DisplayText}"
                                                   Foreground="{DynamicResource AppForeground}"
                                                   TextTrimming="CharacterEllipsis"/>
                                    </DockPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </GroupBox>

                <!-- Output folder -->
                <GroupBox Grid.Row="2"
                          Header="Output Path"
                          Style="{StaticResource SectionGroupBox}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="OutputPathBox"
                                 Grid.Column="0"
                                 IsReadOnly="True"
                                 MinWidth="300"
                                 Margin="0,0,8,0"
                                 VerticalAlignment="Center"
                                 Style="{StaticResource ThemedTextBox}"
                                 ToolTip="{StaticResource TT.Container.OutputPathBox}"/>
                        <Button x:Name="BrowseOutputButton"
                                Grid.Column="1"
                                Content="Browse…"
                                Width="90" Height="24"
                                VerticalAlignment="Center"
                                BorderBrush="{DynamicResource AppBorderBrush}"
                                Click="BrowseOutputButton_Click"
                                ToolTip="{StaticResource TT.Container.BrowseOutputButton}"/>
                    </Grid>
                </GroupBox>
            </Grid>

            <!-- RIGHT column: File info, Container, Track Options, Remux -->
            <StackPanel Grid.Column="1" Orientation="Vertical">

                <!-- File info -->
                <GroupBox Header="File Info" Style="{StaticResource SectionGroupBox}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Filename:" Foreground="{DynamicResource AppForeground}"/>
                        <TextBlock x:Name="FileNameText" Grid.Row="0" Grid.Column="1"
                                   Foreground="{DynamicResource AppForeground}"
                                   TextTrimming="CharacterEllipsis"
                                   ToolTip="{StaticResource TT.Container.FileNameText}"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Codec:" Foreground="{DynamicResource AppForeground}"/>
                        <TextBlock x:Name="CodecText" Grid.Row="1" Grid.Column="1"
                                   Foreground="{DynamicResource AppForeground}"
                                   ToolTip="{StaticResource TT.Container.CodecText}"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Channels:" Foreground="{DynamicResource AppForeground}"/>
                        <TextBlock x:Name="ChannelsText" Grid.Row="2" Grid.Column="1"
                                   Foreground="{DynamicResource AppForeground}"
                                   ToolTip="{StaticResource TT.Container.ChannelsText}"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Sample Rate:" Foreground="{DynamicResource AppForeground}"/>
                        <TextBlock x:Name="SampleRateText" Grid.Row="3" Grid.Column="1"
                                   Foreground="{DynamicResource AppForeground}"
                                   ToolTip="{StaticResource TT.Container.SampleRateText}"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Bitrate:" Foreground="{DynamicResource AppForeground}"/>
                        <TextBlock x:Name="BitrateText" Grid.Row="4" Grid.Column="1"
                                   Foreground="{DynamicResource AppForeground}"
                                   ToolTip="{StaticResource TT.Container.BitrateText}"/>

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Duration:" Foreground="{DynamicResource AppForeground}"/>
                        <TextBlock x:Name="DurationText" Grid.Row="5" Grid.Column="1"
                                   Foreground="{DynamicResource AppForeground}"
                                   ToolTip="{StaticResource TT.Container.DurationText}"/>

                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Size:" Foreground="{DynamicResource AppForeground}"/>
                        <TextBlock x:Name="SizeText" Grid.Row="6" Grid.Column="1"
                                   Foreground="{DynamicResource AppForeground}"
                                   ToolTip="{StaticResource TT.Container.SizeText}"/>

                        <TextBlock Grid.Row="7" Grid.Column="0" Text="Container:" Foreground="{DynamicResource AppForeground}"/>
                        <TextBlock x:Name="ContainerText" Grid.Row="7" Grid.Column="1"
                                   Foreground="{DynamicResource AppForeground}"
                                   ToolTip="{StaticResource TT.Container.ContainerText}"/>
                    </Grid>
                </GroupBox>

                <!-- Container options -->
                <GroupBox Header="Container Options" Style="{StaticResource SectionGroupBox}">
                    <StackPanel>
                        <TextBlock Text="Output Container:" Margin="0,0,0,6" Foreground="{DynamicResource AppForeground}"/>
                        <StackPanel Orientation="Horizontal">
                            <RadioButton x:Name="ContainerMp4Radio"
                                         Content="MP4"
                                         GroupName="ContainerType"
                                         Margin="0,0,12,0"
                                         Foreground="{DynamicResource AppForeground}"
                                         ToolTip="{StaticResource TT.Container.ContainerMp4Radio}"/>
                            <RadioButton x:Name="ContainerMkvRadio"
                                         Content="MKV"
                                         GroupName="ContainerType"
                                         Margin="0,0,12,0"
                                         IsChecked="True"
                                         Foreground="{DynamicResource AppForeground}"
                                         ToolTip="{StaticResource TT.Container.ContainerMkvRadio}"/>
                            <RadioButton x:Name="ContainerMovRadio"
                                         Content="MOV"
                                         GroupName="ContainerType"
                                         Foreground="{DynamicResource AppForeground}"
                                         ToolTip="{StaticResource TT.Container.ContainerMovRadio}"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Track Options (apply to selected tracks) -->
                <GroupBox Header="Track Options (apply to selected)" Style="{StaticResource SectionGroupBox}">
                    <StackPanel>
                        <DockPanel Margin="0,0,0,6">
                            <TextBlock Text="Language:" Width="80" VerticalAlignment="Center" Foreground="{DynamicResource AppForeground}"/>
                            <ComboBox x:Name="OptLanguageComboBox" Width="160" Height="22" Foreground="Black"
                                      ToolTip="{StaticResource TT.Container.OptLanguageComboBox}">
                                <ComboBoxItem Content="und (Unknown)"/>
                                <ComboBoxItem Content="en (English)"/>
                                <ComboBoxItem Content="fr (French)"/>
                                <ComboBoxItem Content="de (German)"/>
                                <ComboBoxItem Content="es (Spanish)"/>
                                <ComboBoxItem Content="it (Italian)"/>
                                <ComboBoxItem Content="pt (Portuguese)"/>
                                <ComboBoxItem Content="ru (Russian)"/>
                                <ComboBoxItem Content="ja (Japanese)"/>
                                <ComboBoxItem Content="zh (Chinese)"/>
                                <ComboBoxItem Content="ko (Korean)"/>
                                <ComboBoxItem Content="ar (Arabic)"/>
                                <ComboBoxItem Content="nl (Dutch)"/>
                                <ComboBoxItem Content="sv (Swedish)"/>
                                <ComboBoxItem Content="pl (Polish)"/>
                            </ComboBox>
                        </DockPanel>

                        <DockPanel Margin="0,0,0,6">
                            <TextBlock Text="Delay (ms):" Width="80" VerticalAlignment="Center" Foreground="{DynamicResource AppForeground}"/>
                            <TextBox x:Name="OptDelayTextBox" Width="80" Height="22"
                                     Style="{StaticResource ThemedTextBox}" Text="0"
                                     ToolTip="{StaticResource TT.Container.OptDelayTextBox}"/>
                            <TextBlock Text="  (positive = delay audio/subs)" VerticalAlignment="Center" Foreground="{DynamicResource AppForeground}" Opacity="0.75"/>
                        </DockPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <CheckBox x:Name="OptDefaultCheckBox" Content="Default" Margin="0,0,12,0" Foreground="{DynamicResource AppForeground}"
                                      ToolTip="{StaticResource TT.Container.OptDefaultCheckBox}"/>
                            <CheckBox x:Name="OptForcedCheckBox" Content="Forced" Foreground="{DynamicResource AppForeground}"
                                      ToolTip="{StaticResource TT.Container.OptForcedCheckBox}"/>
                        </StackPanel>

                        <Button x:Name="OptApplyButton"
                                Content="Apply to Selected"
                                Width="160" Height="26"
                                HorizontalAlignment="Left"
                                Click="OptApplyButton_Click"
                                ToolTip="{StaticResource TT.Container.OptApplyButton}"/>
                    </StackPanel>
                </GroupBox>

                <!-- Remux action -->
                <Button x:Name="ExtractTracksButton"
                        Content="Remux"
                        Width="220" Height="30" Margin="0,6,0,0"
                        HorizontalAlignment="Center"
                        Click="ExtractTracksButton_Click"
                        ToolTip="{StaticResource TT.Container.ExtractTracksButton}"/>
            </StackPanel>
        </Grid>
    </DockPanel>
</UserControl>
